package dev.client.tenacity.module.impl.exploit;

import dev.client.tenacity.Tenacity;
import dev.client.tenacity.module.Category;
import dev.client.tenacity.module.Module;
import dev.client.tenacity.module.impl.movement.Scaffold;
import dev.event.EventListener;
import dev.event.impl.network.PacketReceiveEvent;
import dev.event.impl.network.PacketSendEvent;
import dev.event.impl.player.MotionEvent;
import dev.settings.impl.BooleanSetting;
import dev.settings.impl.ModeSetting;
import dev.settings.impl.NumberSetting;
import dev.utils.misc.MathUtils;
import dev.utils.network.PacketUtils;
import dev.utils.time.TimerUtil;

import com.craftrise.jS;
import com.craftrise.jy;
import com.craftrise.lE;
import com.craftrise.lv;
import com.craftrise.client.bO.a;

import java.util.ArrayDeque;
import java.util.ArrayList;
import java.util.Deque;
import java.util.List;
import java.util.concurrent.CopyOnWriteArrayList;

@SuppressWarnings("unused")
public final class Disabler extends Module {
    private final ModeSetting mode = new ModeSetting("Mode", "Ping Abuser", "Ping Abuser", "Blink", "Watchdog", "Old Matrix", "Ghostly");
    //Ping Abuser
    private final NumberSetting abuseVL = new NumberSetting("Abuse VL", 100, 1000, 100, 1);
    private final BooleanSetting C0FAbuse = new BooleanSetting("C0F Abuse", true), C00Abuse = new BooleanSetting("C00 Abuse", true);
    private final List<lv<?>> packetAbuseList = new CopyOnWriteArrayList<>();

    private TimerUtil timer1 = new TimerUtil(), timer2 = new TimerUtil(), abuseTimer = new TimerUtil();
    private TimerUtil timer = new TimerUtil();
    private Deque<lv> packetsWD = new ArrayDeque<>();
    private ArrayList<lv> packets = new ArrayList<>();
    private boolean cancel;

    public Disabler() {
        super("Disabler", Category.EXPLOIT, "Disables some anticheats");
        this.addSettings(mode, abuseVL, C0FAbuse, C00Abuse);
        abuseVL.addParent(mode, mode -> mode.is("ping abuser"));
        C0FAbuse.addParent(mode, mode -> mode.is("ping abuser"));
        C00Abuse.addParent(mode, mode -> mode.is("ping abuser"));
    }

    private final EventListener<MotionEvent> onMotion = e -> {
        if (timer1.hasTimeElapsed(10000, true)) {
            cancel = true;
            timer2.reset();
        }
        switch (mode.getMode()) {
            case "Ping Abuser":
                if (abuseTimer.hasTimeElapsed(abuseVL.getValue().longValue())) {
                    if (!packetAbuseList.isEmpty()) {
                        for (lv<?> currentPacket : packetAbuseList) {
                            PacketUtils.sendPacketNoEvent(currentPacket);
                            packetAbuseList.remove(currentPacket);
                        }
                    }
                    abuseTimer.reset();
                }
                break;
            case "Ghostly":
                if(cr.launcher.main.a.q.Z % 15 == 0){
                    if (!packetAbuseList.isEmpty()) {
                        for (lv<?> currentPacket : packetAbuseList) {
                            PacketUtils.sendPacketNoEvent(currentPacket);
                            packetAbuseList.remove(currentPacket);
                        }
                    }
                }
                break;
            case "Watchdog":
                break;
        }
    };


    private final EventListener<PacketReceiveEvent> onPacketReceive = e -> {
    };

    private final EventListener<PacketSendEvent> onPacketSend = e -> {
        switch (mode.getMode()) {
            case "Ping Abuser":
                if (C0FAbuse.isEnabled()) {
                    if (e.getPacket() instanceof jS) {
                    	jS packet = (jS) e.getPacket();
                        if (packet.a() > 100) {
                            packetAbuseList.add(packet);
                            e.cancel();
                        }
                    }
                }
                if (C00Abuse.isEnabled()) {
                    if (e.getPacket() instanceof jy) {
                        packetAbuseList.add(e.getPacket());
                        e.cancel();
                    }
                }

                break;
            case "Blink":
                if(e.getPacket() instanceof lE){
                    if(cr.launcher.main.a.q.Z % 3 == 0){
                        e.cancel();
                    }
                }
                break;
            case "Watchdog":

                // Strafe
                if (e.getPacket() instanceof lE || e.getPacket() instanceof lE.a || e.getPacket() instanceof lE.c) {
                    if (cr.launcher.main.a.q.Z < 50) {
                        e.cancel();
                    }
                }

                // Ping Spoof (Timer)
                if (e.getPacket() instanceof lE.a) {
                	lE.a c03 = (lE.a) e.getPacket();
                    if (cancel) {
                        if (!timer2.hasTimeElapsed(400, false)) {
                            if(!Tenacity.INSTANCE.isToggled(Scaffold.class)) {
                                e.cancel();
                                packets.add(e.getPacket());
                            }
                        } else {
                            packets.forEach(PacketUtils::sendPacketNoEvent);
                            packets.clear();
                         cancel = false;
                        }
                    }
                }
                break;
            case "Old Matrix":
                if(e.getPacket() instanceof lE){
                	lE packetPlayer = (lE) e.getPacket();

                    //packetPlayer.a() += 1E-5D;
                }
                break;
            case "Ghostly":
                if(e.getPacket() instanceof jS){
                	jS c0FPacketConfirmTransaction = (jS) e.getPacket();

                    if(c0FPacketConfirmTransaction.a() > 100){
                        packets.add(e.getPacket());
                        e.cancel();
                    }
                }

                if(e.getPacket() instanceof jy){
                    packets.add(e.getPacket());
                    e.cancel();
                }

                if(e.getPacket() instanceof lE){
                    if(cr.launcher.main.a.q.Z % 10 == 0){
                        e.cancel();
                    }
                    //Could ban idk tho lmao
                    PacketUtils.sendPacketNoEvent(new com.craftrise.pP());
                }
                break;
        }
    };
}

